# רשימת כל הפיצ'רים והפונקציונליות בפרויקט יקומות

## 🔐 מערכת הרשמה והתחברות

1. **הרשמה באמצעות דף חוזה** - דף הרשמה שמציג את אקורדים לשיר "בוכה אל הקירות" של דויד ברוזה
2. **התחברות עם שם משתמש וסיסמה** - התחברות רגילה
3. **יצירת פרופיל אוטומטית** - כשמשתמש נרשם, נוצר לו פרופיל אוטומטית
4. **התנתקות** - כפתור התנתקות בפרופיל המשתמש

## 📺 מערכת פרקים

5. **הצגת רשימת פרקים** - דף הבית מציג את כל הפרקים בסדר
6. **נגן וידאו YouTube** - נגן וידאו שמציג פרקים מ-YouTube
7. **תיאור פרק** - כל פרק יכול להיות עם תיאור

## 🎯 מערכת רפרנסים

8. **הוספת רפרנס חדש** - לחיצה על "הוסף רפרנס" ואז לחיצה על הווידאו בנקודת הזמן הרצויה
9. **נקודות זמן** - כל רפרנס מקושר לנקודת זמן ספציפית בווידאו
10. **כותרת רפרנס** - כל רפרנס חייב להיות עם כותרת
11. **תיאור רפרנס** - אפשר להוסיף תיאור לרפרנס
12. **מניעת כפילות** - לא ניתן ליצור רפרנס בטווח של +/- 3 שניות מרפרנס קיים
13. **רשימת רפרנסים** - רשימה של כל הרפרנסים בפרק בצד
14. **קפיצה לרפרנס** - לחיצה על רפרנס קופץ לנקודת הזמן שלו בווידאו
15. **נקודות אדומות מהבהבות** - נקודות אדומות בתחתית הווידאו שמציגות איפה יש רפרנסים
16. **פרטי רפרנס** - חלון שמציג את כל הפרטים של רפרנס שנבחר

## ✅ מערכת אימותים

17. **אימות רפרנס** - כל משתמש יכול לאמת רפרנס של משתמש אחר (כפתור "אמת")
18. **ספירת אימותים** - כל רפרנס מציג כמה אימותים יש לו
19. **מניעת אימות כפול** - משתמש לא יכול לאמת את אותו רפרנס פעמיים
20. **מניעת אימות עצמי** - משתמש לא יכול לאמת רפרנס שהוא יצר

## 🔗 מערכת קישורים בין רפרנסים

21. **קישור רפרנסים** - אפשר לקשר רפרנס אחד לרפרנס אחר
22. **רפרנסים מקושרים** - כל רפרנס מציג את הרפרנסים המקושרים אליו
23. **פתיחת רפרנס מקושר** - לחיצה על רפרנס מקושר פותחת אותו בטאב חדש
24. **מניעת קישור כפול** - לא ניתן לקשר את אותו רפרנס פעמיים

## ✏️ מערכת עריכה

25. **עריכת רפרנס** - כל משתמש מחובר יכול לערוך כל רפרנס (כותרת, תיאור)
26. **מחיקת רפרנס** - רק היוצר של רפרנס יכול למחוק אותו
27. **עריכת דמות** - כל משתמש מחובר יכול לערוך תוכן של דמות
28. **מחיקת דמות** - רק היוצר של דמות יכול למחוק אותה
29. **עריכת פריט יקום** - כל משתמש מחובר יכול לערוך תוכן של פריט יקום
30. **מחיקת פריט יקום** - רק היוצר של פריט יקום יכול למחוק אותו

## 👥 מערכת דמויות

31. **רשימת דמויות** - דף שמציג את כל הדמויות
32. **דף דמות** - דף פרטי לכל דמות
33. **הוספת דמות חדשה** - טופס להוספת דמות עם: כותרת, תיאור, תפקיד, הופעה ראשונה, תמונה
34. **תוכן דמות** - כל דמות יכולה להיות עם תוכן עשיר (Markdown) שמחולק לסעיפים
35. **קישור רפרנסים לדמות** - אפשר לקשר רפרנסים לדמות
36. **רפרנסים קשורים** - כל דמות מציגה את הרפרנסים הקשורים אליה
37. **ספירת צפיות** - כל דמות מציגה כמה פעמים נצפתה

## 🌌 מערכת יקום מאוחדת

38. **דף יקום** - דף שמציג את כל הפריטים מהיקום (תכניות, פרסומות, מושגים) ביחד
39. **הוספת פריט יקום** - טופס מאוחד להוספת תכנית/פרסומת/מושג
40. **דף פריט יקום** - דף פרטי לכל פריט יקום
41. **תצוגה מיוחדת לאקורדים איורו** - תצוגה מיוחדת עם תמונה גדולה לפריט "אקורדים איורו"
42. **תצוגה מיוחדת ללימוד איטלקית** - תצוגה מיוחדת לפריט "לימוד איטלקית"

## 🎮 מערכת נקודות

43. **ניקוד 10 נקודות על הוספת ערך חדש** - יצירת דמות/פריט יקום = 10 נקודות
44. **ניקוד 2 נקודות על עריכת ערך** - עריכת תוכן של ערך = 2 נקודות
45. **ניקוד 1 נקודה על אימות רפרנס** - אימות רפרנס של משתמש אחר = 1 נקודה למאמת
46. **ניקוד 5 נקודות ליוצר רפרנס מאומת** - כשהרפרנס מגיע ל-2+ אימותים, היוצר מקבל 5 נקודות
47. **הצגת נקודות** - כל משתמש רואה את מספר הנקודות שלו בפרופיל
48. **טבלת מובילים** - דף פרק מציג את 5 התורמים המובילים לפי נקודות

## 📊 מערכת סטטיסטיקות

49. **ספירת צפיות** - כל ערך (דמות/פריט יקום) סופר כמה פעמים נצפה
50. **סטטיסטיקות ויקי** - דף הבית מציג כמה דמויות/פריטי יקום יש בסך הכל
51. **ספירת אימותים** - כל רפרנס מציג כמה אימותים יש לו

## 🎨 עיצוב ואפקטים

52. **עיצוב wireframe** - עיצוב מיוחד עם מסגרות לבנות דקות
53. **אפקט glitch** - אפקט מיוחד על טקסטים וכותרות
54. **אפקט RGB split** - אפקט מיוחד על כרטיסים
55. **עיצוב retro** - עיצוב רטרו עם צבעים מיוחדים (כתום, טורקיז, אדום)
56. **גופן Heebo** - גופן עברי מיוחד
57. **גופן מונו** - גופן מונוספייס לטקסטים טכניים
58. **רקע שחור** - רקע שחור עם טקסט לבן
59. **אפקט grain** - רקע עם אפקט grain/noise
60. **עיצוב responsive** - האתר מותאם למובייל וטאבלט
61. **אנימציות** - אנימציות חלקות על כפתורים וכרטיסים

## 🖱️ עכבר אקדח

62. **עכבר אקדח** - עכבר מיוחד בצורת אקדח שעוקב אחרי העכבר
63. **תמיכה במובייל** - עכבר האקדח עובד גם במובייל (עם מגע)
64. **אפקט drop-shadow** - אפקט צל לעכבר האקדח

## 🖼️ מערכת תמונות

65. **העלאת תמונות** - קומפוננטה מיוחדת להעלאת תמונות עם drag & drop
66. **תצוגה מקדימה** - תצוגה מקדימה של תמונה לפני שמירה
67. **חיתוך תמונות** - תמונות נחתכות אוטומטית ל-1:1
68. **הדבקת תמונות** - אפשר להדביק תמונות מהלוח (Ctrl+V)
69. **תמונות placeholder** - אם אין תמונה, מוצגת תמונת placeholder

## 📱 ניווט

70. **ניווט בין דפים** - קישורים בין כל הדפים
71. **כפתור חזרה** - כפתור חזרה לדף הקודם בכל דף
72. **קישורים מהירים** - קישורים מהירים לדמויות מדף הבית (F - צריך לערוך: להשאיר רק קישור לדמויות, להסיר קישורים לתכניות/פרסומות/מושגים)

## 🔍 חיפוש וסינון

73. **מיון לפי תאריך** - הפריטים ביקום ממוינים לפי תאריך יצירה
74. **מיון לפי כותרת** - דמויות ממוינות לפי כותרת (F - צריך לערוך: להשאיר רק מיון דמויות, להסיר מיון תכניות/פרסומות/מושגים)

## 📝 תוכן עשיר

75. **תמיכה ב-Markdown** - תוכן עשיר עם Markdown שמחולק לסעיפים
76. **סעיפים דינמיים** - כל ערך יכול להיות מחולק לסעיפים (## כותרת)
77. **תצוגה מיוחדת לאקורדים** - תצוגה מיוחדת עם עיצוב מיוחד לאקורדים איורו
78. **תצוגה מיוחדת לאיטלקית** - תצוגה מיוחדת עם עיצוב מיוחד ללימוד איטלקית

## 🔒 אבטחה

79. **גישה ציבורית לקריאה** - כולם יכולים לקרוא את התוכן
80. **גישה מוגבלת לכתיבה** - רק משתמשים מחוברים יכולים לכתוב

## 🗄️ מסד נתונים

81. **טבלת chapters** - טבלה לפרקים
82. **טבלת references** - טבלה לרפרנסים
83. **טבלת characters** - טבלה לדמויות
84. **טבלת universe_items** - טבלה מאוחדת לפריטי יקום
85. **טבלת profiles** - טבלה לפרופילי משתמשים
86. **טבלת verifications** - טבלה לאימותים
87. **טבלת reference_links** - טבלה לקישורים בין רפרנסים
88. **טבלת reference_connections** - טבלה לקישורים בין רפרנסים לערכי ויקי

## ⚙️ פונקציות מסד נתונים

89. **פונקציה increment_view_count** - מגדילה את מספר הצפיות של ערך
90. **פונקציה award_wiki_points** - מעניקה נקודות למשתמש
91. **Triggers לעדכון תאריכים** - עדכון אוטומטי של תאריכי עדכון

## 📚 תיעוד

92. **מדריך מפתח (DEVELOPER-GUIDE.md)** - מדריך טכני למפתחים

## 🎯 פיצ'רים מיוחדים

93. **נקודות מהבהבות** - נקודות אדומות מהבהבות שמציגות איפה יש רפרנסים
94. **טבלת מובילים** - רשימת 5 התורמים המובילים
95. **תצוגה מיוחדת לאקורדים** - תצוגה מיוחדת עם עיצוב מיוחד לאקורדים איורו
96. **תצוגה מיוחדת לאיטלקית** - תצוגה מיוחדת עם עיצוב מיוחד ללימוד איטלקית

## ✅ פיצ'רים שהוחלט עליהם

### RLS Policies - מערכת אבטחה
**מה זה:** מערכת Row Level Security של Supabase שמגבילה גישה לטבלאות לפי משתמשים.

**מה זה שומר:**
- **קריאה (SELECT):** כל אחד יכול לקרוא את כל התוכן (גישה ציבורית)
- **כתיבה (INSERT):** רק משתמשים מחוברים יכולים להוסיף תוכן
- **עדכון (UPDATE):** רק משתמשים מחוברים יכולים לעדכן תוכן
- **מחיקה (DELETE):** רק משתמשים מחוברים יכולים למחוק (עם בדיקות נוספות בקוד)
- **פרופילים:** משתמשים יכולים לעדכן רק את הפרופיל שלהם (`auth.uid() = id`)
- **אימותים:** משתמשים יכולים להוסיף רק אימותים שלהם (`auth.uid() = user_id`)

**שימוש נוכחי:** כל הטבלאות מוגנות ב-RLS, יש 30 מדיניות פעילות.

**החלטה:** ✅ להשאיר - זה חלק מהאבטחה הבסיסית

---

### בדיקות הרשאות בקוד
**מה זה:** בדיקות נוספות בקוד JavaScript שמגבילות פעולות מעבר ל-RLS.

**איפה זה נמצא:**
1. **מחיקת רפרנס** (`app/chapter/[chapterId]/page.tsx`):
   - בדיקה: `selectedReference.userId === user.id`
   - רק היוצר של הרפרנס יכול למחוק אותו
   - בדיקה כפולה: גם בקוד וגם ב-query (`.eq('user_id', user.id)`)

2. **מחיקת דמות** (`app/characters/[id]/page.tsx`):
   - בדיקה: `character.created_by !== user.id` → הודעת שגיאה
   - רק היוצר של הדמות יכול למחוק אותה
   - בדיקה כפולה: גם בקוד וגם ב-query (`.eq('created_by', user.id)`)
   - כפתור מחיקה מוצג רק אם `character.created_by === user.id`

3. **מחיקת פריט יקום** (`app/universe/[id]/page.tsx`):
   - בדיקה: `item.created_by !== user.id` → הודעת שגיאה
   - רק היוצר של הפריט יכול למחוק אותו
   - בדיקה כפולה: גם בקוד וגם ב-query (`.eq('created_by', user.id)`)
   - כפתור מחיקה מוצג רק אם `item.created_by === user.id`

4. **עריכת תוכן:**
   - כל משתמש מחובר יכול לערוך כל תוכן (דמות, פריט יקום, רפרנס)
   - אין הגבלה על עריכה, רק על מחיקה

**למה זה חשוב:**
- RLS מגן ברמת מסד הנתונים, אבל בדיקות בקוד נותנות חווית משתמש טובה יותר (הודעות שגיאה ברורות)
- בדיקות כפולות (קוד + query) מונעות ניסיונות לעקוף את האבטחה
- הסתרת כפתורי מחיקה מונעת ניסיונות מיותרים

**החלטה:** ✅ להשאיר - זה חלק מהאבטחה וחווית המשתמש

---

### סקריפטים SQL
**מה זה:** קבצי SQL בתיקיית `scripts/` שמגדירים את הטבלאות, הפונקציות והטריגרים.

**קבצים קיימים:**
- `setup-chapters-system.sql` - הגדרת מערכת הפרקים
- `setup-wiki-system.sql` - הגדרת מערכת הויקי
- `setup-reputation-system.sql` - הגדרת מערכת המוניטין
- `create-universe-table.sql` - יצירת טבלת יקום
- `migrate-data-to-universe.sql` - העברת נתונים ליקום
- `add-special-universe-items.sql` - הוספת פריטים מיוחדים
- `fix-rls-policies.sql` / `fix-all-rls-policies.sql` - תיקון RLS policies
- `insert-initial-data.sql` - הכנסת נתונים ראשוניים
- `cleanup-old-tables.sql` - ניקוי טבלאות ישנות
- `update-constraints-for-universe.sql` - עדכון constraints
- `verify-rls-policies.sql` - אימות RLS policies
- `check-vercel-config.js` - בדיקת הגדרות Vercel (לא בשימוש)
- `upload-character-image.js` - העלאת תמונות דמויות (לא בשימוש)

**החלטה:** ✅ לארגן מחדש - ליצור תיקיית `scripts/archive/` לסקריפטים ישנים, ולהשאיר רק את הרלוונטיים

---

### מדריכים
**מה זה:** קבצי Markdown שמסבירים איך להשתמש במערכת, לפתור בעיות ולפרוס.

**קבצים קיימים:**
- `USER-GUIDE.md` - מדריך למשתמשים (הגדרה מקומית, Supabase, פריסה)
- `DEVELOPER-GUIDE.md` - מדריך למפתחים (מבנה מסד נתונים, קוד)
- `TROUBLESHOOTING-REACT-PLAYER.md` - פתרון בעיות נגן הווידאו
- `VERCEL-DEPLOYMENT-FIX.md` - פתרון בעיות פריסה

**החלטה:** ✅ לארגן ולהשאיר 2 קבצים:
1. **`PROJECT-INFO.md`** - קובץ למשתמש: מה הפרויקט, מה מצופה, מה נכשל בדרך, מה עובד טוב
2. **`DEVELOPER-GUIDE.md`** - קובץ למפתח: מבנה טכני, איך הכל עובד, איך להוסיף פיצ'רים

---

### קבצים שנמחקו
- ✅ **גריד Masonry** - נמחק מ-`app/page.tsx` ו-`app/globals.css`
- ✅ **אפקט parallax** - נמחק מ-`app/page.tsx` (mouse tracking)
- ✅ **תמונות כיסוי לפרקים** - נמחק מהרשימה (לא בשימוש)

---

### קבצים שנשארים
- ✅ **תמונות דמויות** (`public/character/`) - נשארות למקרה שיהיה צורך
- ✅ **תמונות יקום** (`public/yekum/`) - נשארות למקרה שיהיה צורך
- ✅ **קובץ Untitled.3dm** - נשאר

---

## 📝 רשימת כל הטקסטים הקבועים בפרויקט

**נוצר קובץ נפרד עם כל הטקסטים:** `TEXTS-LIST.md`

### סיכום טקסטים:

- **סה"כ: 453 טקסטים קבועים** בפרויקט (כולל console.logs והערות)
- **4 טקסטים מבלבלים** בדף הבית שצריך לשקול להסיר:
  - "ברוכים הבאים ל.. מה זה משנה בכלל???"
  - "תשחיזו שופורניים"
  - "תמירו דומבה למרכז השדה"
  - "ויאללה"
- **כל הטקסטים ב-ContractModal** - קומפוננטה שלא בשימוש (5 טקסטים)
- **Placeholders רבים** עם "רפרנס" במקום טקסטים יותר ספציפיים

### קטגוריות טקסטים:
1. **כותרות וטקסטים ראשיים** - 22 טקסטים
2. **דף התחברות** - 15 טקסטים
3. **דף חוזה** - 66 טקסטים (כולל כל אקורדי השיר)
4. **דף פרק** - 58 טקסטים
5. **דמויות** - 33 טקסטים
6. **תכניות** - 28 טקסטים (לא בשימוש - יש universe_items)
7. **פרסומות** - 32 טקסטים (לא בשימוש - יש universe_items)
8. **מושגים** - 30 טקסטים (לא בשימוש - יש universe_items)
9. **יקום** - 39 טקסטים
10. **קומפוננטות** - 8 טקסטים
11. **Metadata** - 2 טקסטים
12. **Placeholders** - 3 טקסטים
13. **טקסטים מיוחדים** - 5 טקסטים (POKITO, פוקיטו, וכו')
14. **סיבות לניקוד** - 10 טקסטים
15. **טקסטים בסקריפטים** - 19 טקסטים (כולל console.logs והערות)
16. **Console Logs** - 49 טקסטים (רובם באנגלית, לא מוצגים למשתמש)

---

## 🗄️ מבנה מסד הנתונים - Supabase

**נוצר קובץ נפרד עם כל הפרטים:** `DATABASE-SCHEMA.md`

### סיכום מסד הנתונים:
- **11 טבלאות** (מתוכן 3 לא בשימוש: `reference_links`, `edit_history`, `edit_approvals`)
- **8 פונקציות** (כולן בשימוש)
- **5 טריגרים** (מתוכם 2 לא עובדים: `update_chapters_updated_at`, `update_profiles_updated_at`)
- **38 אינדקסים** (כולם בשימוש)
- **30 RLS Policies** (כולן בשימוש)

### טבלאות במסד הנתונים:

1. **`chapters`** - פרקים (7 שדות)
   - `id`, `created_at`, `title`, `description`, `video_url`, `image_url`, `order_index`
   - ⚠️ בעיה: יש טריגר לעדכון `updated_at` אבל אין שדה כזה

2. **`references`** - רפרנסים (12 שדות)
   - `id`, `created_at`, `timestamp`, `title`, `description`, `image_url`, `user_id`, `status`, `created_by_username`, `verified`, `verification_count`, `chapter_id`
   - ⚠️ בעיות: `status` לא בשימוש, `chapter_id` צריך להיות NOT NULL

3. **`profiles`** - פרופילי משתמשים (4 שדות)
   - `id`, `username`, `points`, `avatar_url`
   - ⚠️ בעיות: `avatar_url` לא בשימוש, יש טריגר לעדכון `updated_at` אבל אין שדה כזה

4. **`verifications`** - אימותים (3 שדות)
   - `reference_id`, `user_id`, `created_at`
   - Primary Key מורכב: (`reference_id`, `user_id`)

5. **`characters`** - דמויות (13 שדות)
   - `id`, `title`, `description`, `content`, `image_url`, `links`, `created_by`, `updated_by`, `created_at`, `updated_at`, `version`, `view_count`, `verified`
   - ⚠️ בעיות: `links` לא בשימוש, `verified` לא מעודכן

6. **`universe_items`** - פריטי יקום (14 שדות)
   - `id`, `title`, `description`, `content`, `image_url`, `item_type`, `links`, `created_by`, `updated_by`, `created_at`, `updated_at`, `version`, `view_count`, `verified`
   - ⚠️ בעיות: `links` לא בשימוש, `verified` לא מעודכן
   - `item_type` יכול להיות: 'program', 'advertisement', 'concept'

7. **`reference_links`** - קישורים בין רפרנסים (4 שדות)
   - `id`, `source_reference_id`, `target_reference_id`, `created_at`
   - ⚠️ לא בשימוש (משתמשים ב-`reference_connections` במקום)

8. **`reference_connections`** - קישורים בין רפרנסים לפריטים (6 שדות)
   - `id`, `reference_id`, `entity_type`, `entity_id`, `created_by`, `created_at`
   - `entity_type` יכול להיות: 'character', 'universe_item'

9. **`edit_history`** - היסטוריית עריכות (6 שדות)
   - `id`, `entity_type`, `entity_id`, `content`, `edited_by`, `created_at`
   - ⚠️ לא בשימוש (לא נשמרות עריכות)

10. **`edit_approvals`** - אישורי עריכות (6 שדות)
    - `id`, `entity_type`, `entity_id`, `edit_id`, `approved_by`, `approved_at`
    - ⚠️ לא בשימוש (לא קיימת מערכת אישורים)

### פונקציות במסד הנתונים:

1. **`increment_points(user_id_param, points_to_add)`** - מוסיף נקודות למשתמש
2. **`award_wiki_points(user_id_param, points_to_add, reason)`** - מוסיף נקודות עם סיבה
3. **`increment_view_count(entity_type_param, entity_id_param)`** - מגדיל מספר צפיות
4. **`update_updated_at_column()`** - עדכון גנרי של `updated_at`
5. **`update_chapters_updated_at()`** - לא עובד (אין שדה `updated_at` ב-`chapters`) ⚠️
6. **`update_wiki_updated_at()`** - מעדכן `updated_at` ו-`version` ב-`characters`
7. **`update_universe_items_updated_at()`** - מעדכן `updated_at` ו-`version` ב-`universe_items`
8. **`handle_new_user()`** - יוצר פרופיל אוטומטית בעת הרשמה

### טריגרים במסד הנתונים:

1. **`update_chapters_updated_at`** - לא עובד (אין שדה) ⚠️
2. **`update_characters_updated_at`** - מעדכן `updated_at` ו-`version`
3. **`update_profiles_updated_at`** - לא עובד (אין שדה) ⚠️
4. **`update_universe_items_updated_at`** - מעדכן `updated_at` ו-`version`
5. **`on_auth_user_created`** (ב-`auth.users`) - יוצר פרופיל אוטומטית

### בעיות שזוהו במסד הנתונים:

1. **`chapters.updated_at`** - אין שדה אבל יש טריגר שמנסה לעדכן אותו
2. **`profiles.updated_at`** - אין שדה אבל יש טריגר שמנסה לעדכן אותו
3. **`references.status`** - קיים אבל לא בשימוש
4. **`references.chapter_id`** - nullable אבל צריך להיות NOT NULL
5. **`characters.links`** - לא בשימוש
6. **`universe_items.links`** - לא בשימוש
7. **`characters.verified`** - לא מעודכן
8. **`universe_items.verified`** - לא מעודכן
9. **`reference_links`** - טבלה שלמה שלא בשימוש
10. **`edit_history`** - טבלה שלא בשימוש
11. **`edit_approvals`** - טבלה שלא בשימוש
12. **`profiles.avatar_url`** - לא בשימוש
13. **`award_wiki_points`** - יש הערה על `points_log` שלא קיים

---

**סה"כ: 103 פיצ'רים ופונקציונליות (נמחקו 3: תמונות כיסוי, גריד Masonry, אפקט parallax)**
**סה"כ: 345 טקסטים קבועים (הוסרו 108 טקסטים של תכניות/פרסומות/מושגים)**
**סה"כ: 11 טבלאות במסד הנתונים (מתוכן 3 לא בשימוש)**
**סה"כ: 13 בעיות/שדות/טבלאות שלא בשימוש או לא עובדים במסד הנתונים**
